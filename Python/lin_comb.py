import numpy as np
from matplotlib import pyplot as plt
from fractions import Fraction

from monomials import generate_T
from plotting import gaskplot
from orthog_comp import null_G

W = [[Fraction(1), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0)],
    [Fraction(1,3), Fraction(1), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0)],
    [Fraction(1,18), Fraction(1,3), Fraction(1), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0)],
    [Fraction(7,1620), Fraction(19,540), Fraction(1,3), Fraction(1), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0)],
    [Fraction(13,75330), Fraction(19,8370), Fraction(29,465), Fraction(1,3), Fraction(1), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0)],
    [Fraction(203899,13191036300), Fraction(463921,2198506050), Fraction(5351,787995), Fraction(11188,262665), Fraction(1,3), Fraction(1), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0)],
    [Fraction(444037771585561145716506624,3359557595157326908811710759436288), Fraction(1395207680016463230402560,466605221549628727639710629888), Fraction(87137555247063467873533952,310746453477380235198732435456), Fraction(3954390480653701642977280,1381095348788356663188914176), Fraction(131487246472733114368,2049836420197464932352), Fraction(2684419850794993,8053259552507376), Fraction(1), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0)],
    [Fraction(8764077445600219252977578278912,363834971965393307498211011755946016768), Fraction(5706312782861990972447038373888,12127832398846445472220293539722952704), Fraction(552053155951195804641863401472,15614900539851878337056628419854336), Fraction(2209192383778069672987673493504,6453745289185714060851028340768768), Fraction(2955128993430240199163426897920,375744896088848091371647465947136), Fraction(4350594722499957363968896401408,94957174604892900541758554767360), Fraction(781674030851753,2345022058103100), Fraction(1), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0)],
    [Fraction(24989506478334545889052327936,725136721518465002338288738368235765760), Fraction(253767729407022860784902340608,219555201951587686824060728322365063168), Fraction(773267887208360008360023556096,2809685566295332674722657727607209984), Fraction(45399779154918573512455094272,10042945251566151676986808181194752), Fraction(2219760783663089899509355905024,7020355354395487779130761585623040), Fraction(1058161948205908834585350766592,346900451924389305047914790256640), Fraction(24917294063232407479518576508928,385081450731471096278940404154368), Fraction(2186130616813399,6558391853153551), Fraction(1), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0)],
    [Fraction(7154262914634160926035902726144,143864744317874489729839274375729043734528), Fraction(2686437344699897994119210860544,2224489436313746409785772709272243666944), Fraction(3251990797300782183805580476416,23498116236934799035013954683784921088), Fraction(58646507930223398064220348088320,35815816444706118065679484457100247040), Fraction(59731999163458206258912179519488,935614267615824186480122456415666176), Fraction(37798444402884406641253190467584,74009778158813607822202423224565760), Fraction(18488112178037958120938569465856,2029659323548788877442403553771520), Fraction(22732299573370070230896570531840,458780365189089335697381982732288), Fraction(7523734203692673,22571068436944324), Fraction(1), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0)],
    [Fraction(565971406493128683516067840,36636581345384488536978415345908599226368), Fraction(2508046730812220927656329216,4010019975684958965961649405876947124224), Fraction(148815526305263191938568290304,690604032733359365198288824443403763712), Fraction(108438709058489359670980902912,25461871805246996332731232118336651264), Fraction(194964814579197911579551072256,388082463179760170565026682878558208), Fraction(926020918113885758076305276928,137528648638979217321400598637051904), Fraction(235689090416884184406346956800,648246821456844818377161714958336), Fraction(352647444434657631026569805824,107030092628996728112202765041664), Fraction(58466983575624398885513796255744,893443066900158812803739345223680), Fraction(1588866954570653,4766601629723186), Fraction(1), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0)],
    [Fraction(16220917029781889685583374057472,1081612688382192931698672746278099532394790912), Fraction(47248717739413000210465725349888,90000093840190243865811252425659529509732352), Fraction(76041001922264954134053443862528,558875850334815821272604260910145436909568), Fraction(10525273128959097918767461564416,4503268268363725889920415317167433580544), Fraction(93744273022964541395094598582272,492284199675082599950682576474397999104), Fraction(172439565766473923921503768805376,82898249901687976420390900318569758720), Fraction(23346213032363817406019074523136,321409441312998265337067743653920768), Fraction(41120044261685150737153424097280,73311653398271496186157468343074816), Fraction(18385083422469793879919951872,1936268846477731828326706708480), Fraction(402386268523697765347145809920,7916026163572704802488346214400), Fraction(7628549050730857,22823548385044772), Fraction(1), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0)],
    [Fraction(5921718258590665214835818496,4470569282828202028320724663114120642932244480), Fraction(927955624087655646066900992,12078226386605537839715521759480376876597248), Fraction(103832186564386229447557120,1908669979156092610800271042125108346880), Fraction(27944981685541482387621281792,18720603087972195366286248459917215137792), Fraction(25517024312591049786923155456,74744445394928627484186791294521049088), Fraction(113237494470956886787457286144,18633692769119874165553405304764366848), Fraction(6882056424209746170696695808,11252707989005650024418757086019584), Fraction(309470950508797859985929273344,39927963299786224535498294109929472), Fraction(1363359935766346635596458360832,3547054004567293057515372217892864), Fraction(2873051693489588172006593921024,844782167307730868022713044172800), Fraction(7409346256233216054842378682368,112699008303502015879476609548288), Fraction(353081050252160910594845412737746), Fraction(1), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0)],
    [Fraction(25475577252246807358311835369472,2329663914633551297898688150768691944625954357248), Fraction(11090835036109352420002301476864,25167530218361279684262890840501432992449691648), Fraction(46166928178289205519191650598912,293392448695601348085081233088917613255327744), Fraction(113731242195110007096396576980992,35086477360663550984925546049945412539777024), Fraction(23818244401964774719627116675072,53696043161315374375219221153963902500864), Fraction(14118240156578580221232506994688,2152683490737352055325318169836749062144), Fraction(14372513626200233714710961192960,29934215421291968786452936010955227136), Fraction(237897091798433930797716841955328,44231657598968417075077940304897114112), Fraction(25951171228494096313078572384256,120035178567953513164869587412451328), Fraction(73676182978856581826139071184896,41095869421813737314960972869271552), Fraction(1584464792642355025424746020864,48693040267539224986957746536448), Fraction(10198201086990892192046860206080,61125242665833765633086346756096), Fraction(5986385761529983,8810087361680186), Fraction(1), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0)],
    [Fraction(1149199149571805857402134200320,8933293809582995844965397984233347989703825031168), Fraction(1382611486105123223058419548160,225867489513684314674924801872407246229890662400), Fraction(1892498919839377175912139194368,586275340397044683752547520422301784900370432), Fraction(547632949299257691303370031104,6793354891914031374261070471027295764086784), Fraction(3721049368541945451508469334016,229862488561840482801946501767599832956928), Fraction(6643335225259840930575143665664,23904125092551595346423441218906439548928), Fraction(41835873760747067631864905728,1571976330899857117417167960590516224), Fraction(4451468062629286186700798689280,13388446667536656602859718247092060160), Fraction(834971453796879849558814752768,51201514644696854206359354170408960), Fraction(15214159670540568410074801766400,104638177009375278299563852302385152), Fraction(10584844593935130526291205292032,3507134369247293011390967796727808), Fraction(7391606029600011156281695928320,441884222273826153631910050398208), Fraction(6966571069586405714390952181760,65843764914486649772084555677696), Fraction(540298698318731,1619357784023304), Fraction(1), Fraction(0), Fraction(0), Fraction(0), Fraction(0), Fraction(0)],
    [Fraction(589628959022240680079850995712,1368708955986099367611974698019623668153269092352), Fraction(58027220172048335926819951738880,3317314581480929821497805058355164155469023412224), Fraction(407738886586335157615595618304,67496908355245698606013644058669535327158272), Fraction(2606218694936729858419835535360,21820810746103585234022972413187090525716480), Fraction(14495825407595872770877055565824,1026478602837485534498399483898067047940096), Fraction(4975450112350978924314122780672,26199515697886892386255106619180469714944), Fraction(16358613357319921575874351071232,1565808565448680426465532660880183918592), Fraction(15650759564512051405310778146816,162417329097685436479116403615331254272), Fraction(9980714901338133797633135738880,4890349905984286182371436090519191552), Fraction(24203556479644491891230113792,2279994670562800523912249388040192), Fraction(-264574590346006570176562069504,9953697789039801507288436642414592), Fraction(-3726206075491633405307700379648,4766153123125517060451057958649856), Fraction(-3019662056991818668320543997952,143942521091832636587776508166144), Fraction(-4291430617105443349139470115930112,38177342424538207782031506194563072), Fraction(-3210857608204751,9584491115505166), Fraction(1), Fraction(0), Fraction(0), Fraction(0), Fraction(0)],
    [Fraction(-318062368515416718141269475328,84377993662104594000280535272904003691537911250944), Fraction(-1959061140702626891444518912,9449562290779415894319482991513990780669657088), Fraction(-261840565385907137002212425728,1895001584879943794993360242410215753312632832), Fraction(-1896897926548190424397443497984,508178197073276649695243713969484006411993088), Fraction(-4195322279010602991296184320,5007052488116369082086153520016546332672), Fraction(-19272915761086972161807089664,1297620475425693930081858065499489828864), Fraction(-2249513584546730614684859236352,1509800367463559292491770057606259802112), Fraction(-6850279600231479395246904705024,362486827477407153165548399373288734720), Fraction(-56047041898925512812540442181632,59267765080449768200362505797766217728), Fraction(-994384786776847755319741251584,117639735968709244175656965174722560), Fraction(-241032484716776190478957607387136,1395940030836709267743725989755092992), Fraction(-3452571224740188456562978717696,3703278055434435579348833785610240), Fraction(-13158565408260743088709031690240,2740357500997314486564431136292864), Fraction(-8365661310661194337356152307712,775413152396419222746070777856000), Fraction(8468652512805896820461156696064,362031954326546551524597031763968), Fraction(389881927470806,1156443234776751), Fraction(1), Fraction(0), Fraction(0), Fraction(0)],
    [Fraction(472711063671551588012389964972032,29799801191184526357389203298805469362460441455122972672), Fraction(616161749039578026828097422098432,858574384787811705540770325436610771203289998325448704), Fraction(28806071706563158852963867295744,96407195064676826883790224896268497203564772327424), Fraction(563922788522217334650955091673088,88265033182206005817558573644454697232577524137984), Fraction(638157776239840737045877650096128,735854352201868790924284677861538492085180563456), Fraction(506152233809541118455433996009472,42146049373647316870086691169194027797845114880), Fraction(306477237317035294084109959168,518503416473575719125700148308107207901184), Fraction(196662702634963389180591210496,44877203420327410354880395572825403949056), Fraction(-6530518217478259191630482374656,585797446751672956374023986959659300814848), Fraction(-752087935372398284435361890304,1684385126915873192242726325441475379200), Fraction(310850945440973178892753829888,42002752066998246182222782211104440320), Fraction(94794341850504279577076814577664,614522299846126182366888219447775985664), Fraction(3669243060955858858174264115200,21526726944451961251744168893791338496), Fraction(-272488232702860537269248898105344,15026339925563706156489421229716930560), Fraction(-17297352897517579498604623560704,14714200474721255240806014231490068480), Fraction(118511874117460018017612070912,280271427777746915534037777999986688), Fraction(-446128073702399,15249426242412519424), Fraction(1), Fraction(0), Fraction(0)],
    [Fraction(-3300906527296721505510227548569600,15316370598842805317738808964632300702245039347509231616), Fraction(-79900329939758523829851544092672,9545523366927018356874483124424658914024260244602880), Fraction(-474879464496683178907868445278208,193144979434874303571790320810975701269354316300288), Fraction(-232248644104956592156988143566848,5501267523571302979658495432153528623079744339968), Fraction(-40416782010156393030698447929344,16419420902630529196391793408986330245126684672), Fraction(-56035896441510226544435790872576,5437465918784798113964879931217676736516849664), Fraction(370739077044149105301953731100672,101741140276047410446766695626135178481500160), Fraction(1384270168756193593665502318690304,21305472544335749949576144522289852679454720), Fraction(18401486926696116233900018399969280,4128433944373759145702488212153539464527872), Fraction(395476570987267180889413139824640,9640064826714668408200478454171656257536), Fraction(3175476225295697514553300215660544,4933964721865157136890625601293739098112), Fraction(1303517365399734957635480221384704,716763112034860879594414230373683691520), Fraction(-12181067131957074142895550607917056,200616445167767692478147661378084667392), Fraction(-1867869067403537467853566369595392,4140740460350347855995482001641570304), Fraction(-920550090923959013366055187775488,245111765208138460696659695742484480), Fraction(-62937792067575430834456064776208384,4718310306997406075044916527714271232), Fraction(10496654352102504153451011105619968,642771184261434056589265258072244224), Fraction(4550412072518879,28332911537524460), Fraction(1), Fraction(0)],
    [Fraction(-54651513611109238554184344666112,392100392065192395807898512930365427730309743510770679808), Fraction(-23266702253506489081901051019264,4182611025388891067941251216533027386205065500271050752), Fraction(-3151489509504750390635604738048,1756681063076964356078421049376666991599864483151872), Fraction(-7740436017190874162705599561728,231355032439395021242027804217349970241145819627520), Fraction(-12162344831681173170830369095680,3888117709782259438129599740148675575332835688448), Fraction(-212273322961181810073287872479232,6171920761582680132468322951027796994788931141632), Fraction(-1205958129119758999299708420096,2713778156016162938448516767511871352372985856), Fraction(1021708653897890268719836299264,152889135815879086840402606615235838150180864), Fraction(4024957963824856647887990292480,3486486033872446284096273745980054371827712), Fraction(2164669052978827023657237217280,189640722373940873078158107145018825244672), Fraction(18800240391386707773579790909440,113599156628098641343167304358779701690368), Fraction(3407036446211108982720429031424,7974179685871324495351882426180857495552), Fraction(1037466234796344546533549539328,200807455948221258346070096857859620864), Fraction(3823804897981020643761435181056,32623951267473885087179449958324502528), Fraction(-1824902179679488122595470999552,16244791434124188831828330094658584576), Fraction(-62334878281664633488727183720448,3093251903383778874596445986672869376), Fraction(-84205448543110532135720583168,2580423297388182123104901489754112), Fraction(3321331988955890932942853111808,17433059274690873727398169892880384), Fraction(-1588986192247397,3167342803681533952), Fraction(1)]
    ]

def lin_comb_manual(level):
    ''' Insert weights in the combination manually in the code section below (sum_T) and plot the polynomial
    '''
    T = generate_T(level, 1, frac=True)

    n_pts = T.shape[1]
    sum_T = np.zeros(n_pts)

    sum_T = (Fraction(-1,15)*T[0, :, 0]) + (Fraction(2,15)*T[1, :, 0])

    plt.figure()
    ax = plt.axes(projection='3d')
    gaskplot(sum_T, level, ax)
    plt.show()    
    
    return

def lin_comb(level, i, frac=False,):
    ''' Args:
        level: Level V_m of SG
        i: polynomial number, in range 20 (0 to 19)
        frac: Boolean representing whether the coefficients should 
            remain as fractions or should be converted to floating point 
            numbers at the end of all calculations.
    
        Returns:
        sum_T: Sum of selected T[k_fixed, :, deg] arrays'''
    
    # Generate all degrees needed at once to avoid regenerating T
    T = generate_T(level, i//2, frac=frac)  # shape: (3, 3^level, deg+1)
    W = W[i] # Get the weights from the i'th page of W

    # Start with a zero array
    n_pts = T.shape[1]
    sum_T = np.zeros(n_pts)

    # Add each selected page
    for i in range (i): 
        if i % 2 == 0: # This will be k=1 family with degree i//2
            sum_T += W[i]*T[0, :, i//2]
        else: # This will be k=2 family with degree i//2 
            sum_T += W[i]*T[1, :, i//2]
    
        plt.figure()
        ax = plt.axes(projection='3d')
        gaskplot(sum_T, level, ax)
        plt.show()    
    
    return

def lin_comb_G(j, level):
    ''' This function plots the basis generated from the null space of G'''
    N = null_G(j)
    T = generate_T(level, j, frac=True)

    for i in range(N.shape[1]):  # Loop over number of columns
        sum_T = np.zeros_like(T[0, :, 0])
        for m in range (2*j+2): 
            if m % 2 == 0: # This will be k=1 family with degree m/2
                sum_T += N[m,i]*T[0, :, m//2]
            else: # This will be k=2 family with degree (m-1)/2 
                sum_T += N[m,i]*T[1, :, (m-1)//2]
    
        plt.figure()
        ax = plt.axes(projection='3d')
        gaskplot(sum_T, level, ax) # need to loop this for each column because each column is a different polynomial in the basis
        plt.show()
    
    return 
